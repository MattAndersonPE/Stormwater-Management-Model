SWMM 5.1 Update History
=======================

-------------------------
Build 5.1.015 (July 2020)
-------------------------

Engine Updates:

1. A mix of infiltration methods can now be used within a project.

2. Monthly adjustments to depression storage are now applied only to
   the pervious area of subcatchments instead of to both pervious and
   impervious areas.

3. The Status Report now includes a grouped frequency table of the
   variable routing time steps used during a simulation.

4. An error in the average summary statistics reported for projects
   with a reporting start date later than the simulation start date
   was fixed.

5. A fatal error is now issued if a storage node's area curve produces
   a negative volume when extrapolated to the node's full depth.

6. A pollutant mass balance error occurring when very shallow storage
   units lost all inflow to flooding was fixed.

7. Conduit evaporation and seepage losses are now applied directly to
   the conduit's flow rate instead of just to the downstream node's
   inflow to reduce water quality mass balance errors.

8. Spurious values appearing for Final Water Table and Upper Mositure
   Content in the Groundwater Summary Results Table for completely
   impervious subcatchments were corrected.

GUI Updates:

1. The mouse wheel can now be used to zoom in or out of the Study Area
   Map and when pressed be used to pan the map.

2. The Subcatchment Infiltration Dialog was modified to accept a choice
   of infiltration method.

3. The Group Editor dialog was modified to allow a choice of infiltration
   method and its parameters be assigned to a group of subcatchments.

4. The Control Curve assigned to an LID unit's drain layer was being
   ignored by the input file reader.

5. Some problems with the Graph Options dialog for the Statistics Report
   plots were fixed.

6. Better support for 4K ultra HD monitors was added.

7. The latter update required that the three toolbars on the
   main window be combined into one to avoid resizing issues.

------------------------
Build 5.1.014 (03/01/20)
------------------------

Engine Updates:

1.  Fixed a refactoring bug that produced incorrect rainfall when the same
    time series was used by one rain gage assigned to a RDII Unit Hydrograph
    and also by another gage assigned to a subcatchment.

2.  Fixed skipping the first rain gage in a project when checking
    if two gages have the same station ID but use different data files.

3.  Fixed a program crash when running projects with LID units but no
    subcatchments.

4.  Fixed having LID underdrain pollutant loads incorrectly added to the
    mass balance totals.

5.  Fixed the program from hanging when an LID unit sent its outflow back
    onto the pervious area of its own subcatchment.

6.  Fixed a failure to re-initialize layer volumes as each LID unit is
    evaluated (which could cause incorrect results for certain
    combinations of LID units).

7.  Fixed street sweeping being ignored when the sweeping period
    began with a higher day of the year than the end of the period.

8.  Fixed incorrect adjustments being made for conduit evaporation and
    seepage losses under dynamic wave flow routing.

9.  Fixed having soil moisture deficit recovery be ignored for Green-Ampt
    exfiltration from storage units.

10. Fixed having node/link ID names be mistaken for option keywords
    in the [REPORT] section of an input file.

11. Fixed a possible program crash when using the option to report average
    values within each reporting time interval instead of point values.


------------------------
Build 5.1.013 (05/10/18)
------------------------

Engine Updates:

1.  A subcatchment's depression storage depth, its pervious surface roughness
    (Mannings n) and its hydraulic conductivity can now be adjusted on a
    monthly basis by assigning monthly time patterns to these properties.
    For conductivity, a subcatchment-specific adjustment pattern will
    override any project-wide set of climate adjustment factors.

2.  LID controls can now treat a designated portion of a subcatchment’s
    pervious area runoff (previously they could only treat impervious area
    runoff).

3.  Permeable pavement LID units subjected to clogging over time can now
    have their permeability only partly restored at periodic time
    intervals

4.  The following options were added to control flow out of LID units
    through their underdrains:
    - A storage layer water depth above which a closed drain automatically
      opens.
    - A storage layer water depth below which an open drain automatically
      closes.
    - A control curve that specifies how the nominal drain flow rate is
      adjusted as a function of the head seen by the drain.

5.  Pollutant removal percentages can now be assigned to LID processes that
    have underdrains. The removals apply to flow leaving the unit through the
    drain and not to any surface overflow from the unit.

6.  The Subcatchment Runoff Summary Report now includes both pervious and
    impervious total runoff volumes (prior to any LID treatment) for each
    subcatchment.

7.  A choice of method used to handle surcharging has been added to the list
    of Dynamic Wave options. The EXTRAN method continues to use the traditional
    Surcharge Algorithm to update the head at surcharged nodes. The new SLOT
    option attaches a Preissmann Slot to closed conduits flowing more than 98.5%
    full that eliminates the need to switch to the Surcharge Algorithm for
    surcharged nodes.

8.  A closed vessel can now be modeled as a storage unit node that is allowed
    to pressurize up to a designated Surcharge Depth value. If this depth is 0
    then the unit is modeled as before as an open vessel.

9.  A weir's discharge coefficient can now be allowed to vary with head across
    the weir by assigning it a Weir Curve (see Weir Properties). Weir curves
    tabulate coefficient values at specific head levels.

10. When the upstream offset of a regulator link is below the invert of its
    downstream node it is now automatically raised only for Dynamic Wave flow
    routing with a warning message issued. For other flow routing choices only
    the warning message is issued and no automatic offset adjustment is made.

11. Users can now choose to set a periodic time step for control rule evaluation.
    If this step is 0 then rules are tested as before at every routing time step.

12. The option was added to have time series results for a project's nodes and
    links be reported as average values computed over a reporting time step
    instead of being interpolated point values at the end of the reporting time
    step.

13. The following bugs were fixed:
    -  Unused rain gages are no longer examined when adjusting the wet runoff
       time step.
    -  The surface inflow rate to a permeable pavement LID unit is not allowed
       to exceed the pavement’s permeability.
    -  The Minimum Nodal Surface Area dynamic wave routing option was being used
       as surface area always available at a node instead of an amount available
       only when the surface area of the node's connecting links fell below it.
    -  The top width of a full closed rectangular cross section shape is now set
       to 0 since it can no longer supply any surface area.
    -  The ‘C’ parameter value for a Mitered Corrugated Metal Arch culvert was
       corrected.
    -  An incorrect reporting of flow continuity error for systems with backflow
       through outfall nodes was fixed.

GUI Updates

1.  Various property editors and dialog forms were updated to accomodate the newly
    added engine features (monthly time patterns for subcatchment properties, LID
    underdrain parameters, LID pollutant removal, choice of surcharge method,
    storage unit surcharge depth, weir coefficient curve, control rule time step,
    and reporting of average values).

2.  A bug that failed to record the choice of number of barrels for rectangular
    conduits in the Cross-Section Editor form was fixed.

3.  A bug in the GetLinkOutVal function of the Uoutput.pas unit was fixed.


------------------------
Build 5.1.012 (03/14/17)
------------------------

Engine Updates:

1.  The direct.h header is now only #included in the swmm5.c file when
    compiled for Windows. (swmm5.c)

2.  Engine Update #7 in Build 5.1.011 (internally aligning the wet time
    step with the reporting time step) was redacted since it caused
    problems for certain combinations of time steps. (runoff.c)

3.  A subcatchment's bottom elevation is now used instead its parent
    aquifer's value when saving a water table value to the binary results
    file. (subcatch.c)

4.  A bug that failed to limit surface inflitration into a saturated rain
    garden LID unit was fixed. (lidproc.c)

5.  Calculation of the maximum limit on LID drain flows was modified to
    produce smoother results at low depths above the drain offset.
    (lidproc.c)

6.  A variable used for reporting detailed LID results is now properly
    initialized. (lid.c & lid.h)

7.  The occasional writing of duplicate lines to the detailed LID results
    file was fixed. (lidproc.c)

8.  The conversion from conduit seepage rate per unit area to rate per unit
    of length was changed to use top width instead of wetted perimeter since
    only vertical seepage is assumed to occur. (link.c)

9.  The coefficient of the evaporation/seepage term in the dynamic wave
    equation for updating conduit flow was corrected (from 1.5 to 2.5).
    (dwflow.c)

10. The Engels flow equation for side flow weirs was corrected (the original
    equation used in SWMM 3 & 4 was incorrect). (link.c)

11. Crest length reductions for end contractions are no longer used for
    trapezoidal weirs. (link.c)

12. The Slope Correction Factor for culverts with mitered inlets was corrected.
    (culvert.c)

13. An entry in the table of gravel roadway weir coefficients was corrected.
    (roadway.c)

14. The user supplied minimum slope option is now initialized to 0.0
    (meaning none is provided). (project.c)

15. NO/YES are no longer accepted as attributes for the NORMAL_FLOW_LIMITED
    dynamic wave simulation option (only SLOPE/FROUDE/BOTH are valid).
    (project.c)

16. Changes were made so that the Routing Events and Skip Steady Flow
    options work correctly together. (routing.c & globals.h)

17. Steady state periods with no flow routing no longer contribute to the
    routing time step statistics. (stats.c and report.c)

18. When compiling statistics on the frequency of full conduit flow the
    number of barrels is now accounted for. (stats.c)

19. Under kinematic wave or steady flow routing, the water level in
    storage nodes that have no outflow links is now updated correctly
    over time. (flowrout.c)

20. The formula for the depth at maximum width for the Modified Basket Handle
    cross section was corrected. (xsect.c)


GUI Updates:

1.  Profile plots now correctly update the main and axis title text when
    changed via the Profile Plot Options dialog. Also the downstream
    offset height of non-conduit links is set to 0 on the plot.

2.  The LID Control Editor now sets the Storage Layer Thickness to 0 when
    a Rain Garden is selected as the type of LID being edited.

3.  An OnChange event handler was added to each of the LID Control Editor's
    data fields to record when a value is changed.

------------------------
Build 5.1.011 (08/22/16)
------------------------

Engine Updates:

1.  Detailed flow routing can now be restricted to a set of pre-defined
    event periods. The event periods are listed in an [EVENTS] section
    of the SWMM input file, where each line contains a start date,
    start time, end date and end time for each event.

2.  New functions, swmm_getError() and swmm_getWarnings(), were added to
    the API used for interfacing SWMM with other applications (see the
    updated Interfacing Guide for details).

3.  The error codes returned by the API functions (swmm_open, swmm_start,
    swmm_step, etc.) were corrected.

4.  The new format for precipitation amounts in rainfall files downloaded
    from the NCDC's Climate Data Online service are now recognized.

5.  Monthly adjustments for hydraulic conductivity are now also
    applied to the internal Green-Ampt "Lu" parameter which varies with
    the square root of conductivity.

6.  A check was added to insure that subcatchment imperviousness does
    not exceed 100 percent.

7.  Runoff time steps are now adjusted to stay aligned with the Report
    time step (making model validation easier).

8.  A time step correction was made when computing the outflow volume
    produced by an outfall that sends its outflow back onto a designated
    subcatchment.

9.  The LID routines were modified so that native soil infiltration is
    satisfied first when it occurs along with underdrain flow, instead
    of the other way around.

10. The allowable offset height for an LID underdrain is no longer
    limited to the top of the storage layer thus allowing upturned
    drains to be modelled.

11. The detailed LID report file now lists results by both date/time
    and elapsed hours and reports water level instead of moisture
    content for permeable pavement.

12. If the offset of the opening of a regulator link is below its
    downstream node invert it is now raised to the invert level
    and a warning message is still issued.

13. A weir with an open rectangular shape and non-zero slope parameter
    will no longer generate an input error message - the slope value is
    now ignored.

14. An illegal array index bug that could occur when checking the pump
    curve type for an Ideal Pump in dynamic wave flow routing was fixed.

15. A redundant unit conversion of max. reported depth from the Node
    Depth Summary table was removed.

16. Node surcharging is now only reported for dynamic wave flow routing
    and storage nodes are never classified as surcharged.

17. A failure to convert a storage unit's surface area curve from metric
    to internal units when computing bottom exfiltration was fixed.

18. A bug that caused a link's TIMEOPEN variable (used in control rule
    conditions) to be re-set to 0 when its setting changed from one
    partly opened state to another was fixed.

19. The Status Report no longer lists control actions taken by modulated
    controls since they occur continuously over time and can produce an
    enormous number of actions.

20. A failure to convert a Roadway Weir's road width that was in metric
    units was fixed.

21. A bug that caused the saved link settings read from a hot start
    file to be incorrect in a model containing pollutants was fixed.

22. Rule premises can now include SIMULATION DAYOFYEAR as a condition,
    where day of year is either in month/day format or a number between
    1 and 365.

23. A refactoring bug that affected water quality mass balance results
    for Steady Flow routing was fixed.

24. The function that decodes the fractional part of a date/time value
    into hours:minutes:seconds was modified so that rounding doesn't
    cause the time to exceed 24 hours.

25. Microsoft exception handling statements are now only enabled when
    the engine is compiled with the Microsoft C compiler.

GUI Updates:

1.  A new sub-category of simulation options named Events was added along
    with an Event Editor dialog to allow users to restrict detailed flow
    routing calculations to specific periods of time. See the Help file
    topic under Reference | Special Dialog Forms | Events Editor.

2.  When a Rain Garden is selected in the LID Control Editor, the Storage
    layer tab now appears so that a bottom Seepage Rate can be specified.
    This fixes the problem of having no inflitration out of a Rain Garden.

3.  After a simulation has been completed the Run Status dialog box now
    indicates if any warning messages have been issued.

4.  A previously uninitialized variable (elapsed simulation time) passed
    between the GUI and the engine is now assigned an initial value.

5.  The ground surface line on a Profile Plot can now be made visible or
    not via the Profile Plot Options dialog, with the default being visible.

6.  An option to use thick lines to outline conduits and the ground surface
    in Profile Plots was added.


-------------------------
Build 5.1.010 (08/05/15)
-------------------------

Engine Updates:

1.  A modified version of Green-Ampt infiltration (MODIFIED GREEN AMPT) was
    added that no longer redistributes upper zone moisture deficit during
    low rainfall events. The original authors of SWMM's Green-Ampt model
    have endorsed this modified version. It will produce more infiltration
    for storm events that begin with low rainfall intensities, such as the
    SCS design storm distributions.

2.  A new type of weir, a ROADWAY weir, has been added. It models roadway
    overtopping using the FHWA HDS-5 method and would typically be used in
    parallel with a culvert conduit.

3.  Rule premises can now test whether a link has been open (or closed) for
    a specific period of time. See the Help file for more details.

4.  Unsaturated hydraulic conductivity ("K") was added to the list of
    variables that can be used in a user-supplied groundwater flow equation.

5.  A bug introduced in update 2 of release 5.1.008 that failed to include
    infiltration from LID units into the groundwater routine was fixed.

6.  A bug that failed to properly initialize the flag indicating that one or
    more LID controls was initially wet was fixed.

7.  Duplicate printing of the first line of an LID detailed report file was
    corrected.

8.  The Hargreaves evaporation forumla was modified to use a 7-day running
    average of daily temperatures, instead of just single day values, as
    recommended by the formula's authors.

9.  Daily potential evapotranspiration (PET) was added as a system output
    variable.

10. The qualrout.c module was refactored to make it more compact and easier
    to follow.

11. Storage seepage and evaporation losses are now based on the storage volume
    at the end, not the start, of the prior time step.

12. The command line used to build the engine included in the "makefile"
    for the GNU C/C++ compiler was corrected to include the OpenMP libraries.

GUI Updates:

1.  Potential evapotranspiration (PET) was added as new system-wide variable
    whose time series can be viewed with a graph or table.

2.  A bug in the Number of Threads dropdown list on the Dynamic Wave Options
    dialog was fixed.

3.  Additional bugs in the Cross Section Editor remaining from changes made
    in release 5.1.008 were fixed.

4.  Changes were made to accommodate the new Modified Green-Ampt infiltration
    option and the new Roadway weir option.

5.  The automatic scaling of plots with all y-values the same was improved.

6.  The automatic scaling of profile plots was improved and the ground surface
    line was removed to improve clarity.

7.  The function that automatically converts all link depth offsets to
    elevation offsets now uses the node invert elevation value rather
    than *' for a zero offset.

8.  A bug in using the Macro List on the Add-In Tools Properties form to
    insert a selection into the Working Directory edit box was fixed.


--------------------------
Build 5.1.009 (04/30/2015)
--------------------------

General:

1.  A missing DLL file used to parallelize SWMM's flow routing
    routine was added to the installation package.

Engine Updates:

1.  A re-factoring bug that prevented running simulations longer
    than 68 years was fixed.

2.  An input parsing error that prevented the program from
    recognizing a comparison between two variables in a
    control rule premise was fixed.

3.  A new warning message was added for when a control rule
    premise compares two different types of variables.

4.  When implementing 5.1.008 update 12, the runon to a
    subcatchment fully occupied by LIDs was not being included
    in the subcatchment's Summary Report.

5.  A bug was fixed that allowed LID units to return outflow to
    a subcatchment's pervious area even though LIDs occupied the
    entire subcatchment.

6.  For quality routing the definition of a dry conduit/storage
    node was changed to <= 1 mm of depth to avoid concentrations
    from blowing up due to evaporation losses.

7.  The units label for Total Inflow Volume in the Node Inflow
    Summary table of a saved report file was corrected.

GUI Updates:

1.  A bug introduced as a result of 5.1.008 GUI Update 11 that
    prevented the name of a conduit's Transect or Shape Curve
    from appearing in the Cross Section Editor was fixed.

2.  A nicer default axis scaling routine is now used for time
    series and scatter plots.

3.  The user-supplied custom scaling for the vertical axis of a
    profile plot is now recognized.



--------------------------
Build 5.1.008 (04/02/2015)
--------------------------

Engine Updates:

New Features:
=============

1.  Monthly adjustments for hydraulic conductivity used for
    rainfall infiltration and for exfiltration from storage
    nodes and conduits was added.

2.  LID drains can now send their outflow to a different node
    or subcatchment than the parent subcatchment in which they
    were placed.

3.  Conveyance system Outfall nodes now have the option to
    send their outflow onto a subcatchment, to simulate
    irrigation or complex LID treatment options.

4.  A new LID practice, Rooftop Disconnection, has been added.
    It allows one to explicitly model roof runoff with an
    optional limit on the flow capacity of their downspouts.
    Disconnection is specified by setting the Return To Pervious
    Area field in the [LID_USAGE] section to 1.

5.  An optional soil layer has been added to Permeable Pavement
    LIDs so that a sand filter or bedding layer beneath the
    pavement can be modeled.

6.  Several new built-in variable names can now be used in
    custom groundwater flow equations for porosity, unsaturated
    hydraulic conductivity, infiltration rate, and percolation
    rate. See the Help file for more details.

7.  A Groundwater Summary table has been added that reports
    several groundwater statistics for each subcatchment.

8.  A new option, the Minimum Variable Time Step, was added that
    limits the smallest time step that can be computed under
    variable time stepping for dynamic wave flow routing. In
    previous releases it was fixed at 0.5 seconds which remains
    the default. The smallest value it can now have is 0.001 sec.

9.  The dynamic wave routing procedure was parallelized to take
    advantage of multiple processors, making it run several times
    faster. A new option, THREADS, sets the number of parallel
    threads to use, where the default is 1.

10. A new column was added to the Node Depth Summary report table
    that shows the maximum depth recorded at the Reporting Time Step
    so it can be compared to the maximum depth attained over all
    routing time steps also shown in the table.

11. Control rule premises can now contain conditions that compare
    the values of a node or link variable at two different locations
    (e.g. IF NODE 123 HEAD > NODE 456 HEAD) and node volume was
    added as a condition clause variable.

Improvements:
=============

12. When a subcatchment with LID controls receives runon from another
    source (e.g., a subcatchment, LID drain or outfall node) the
    runon is now distributed only across the non-LID area of the sub-
    catchment instead of the full area. If a single LID takes up the
    full subcatchment area then the runon is directed onto the LID.

13. Storage node HRT was added to the state variables saved in the
    Hot Start file.

14. The threshold value for reporting a non-zero runoff result
    was changed from 0.001 cfs to 0.001 inches/hr.

15. The calculation of overall flow routing mass balance was
    modified to account for cases where some flow streams, like
    total external inflow, are negative.

16. The "Surface Runoff" label in the Runoff Continuity Report was
    replaced with "Total Runoff" since the value reported consists
    of both surface runoff and LID drain flow.

17. The "Internal Outflow" label in the Flow Routing Continuity
    Report was replaced with "Flooding Losses" to improve clarity.

18. The pollutant washoff routines were moved to a new code module
    (surfqual.c) and revised to account for the reduction in
    pollutant load that results from runoff flow reduction by LID
    units.

19. Initial flows for Steady Flow routing are now ignored since they
    are not used in the routing calculation and the initial volume
    associated with them contributed to system mass balance error.

20. The various types of lateral inflows to conveyance system nodes
    are now evaluated at the date/time for the start of the routing
    time step instead of at the end of the time step.

21. The final runoff and routing time steps are adjusted to insure
    that the simulation's total duration is not exceeded.

22. When evaluating user-supplied math expressions, any NaN (Not a
    Number) result (caused by an underflow, overflow or divide by zero)
    is set to 0 so that the NaN doesn't propagate through subsequent
    calculations.

Bug Fixes:
==========

23. The evaporation rates read from a time series would only change
    when a new day was reached (even though values at more frequent
    intervals were present) and could cause a run to stop pre-
    maturely in some rare cases.

24. The runoff read from a Hot Start file should have been assigned
    to a subcatchment's newRunoff property, not to oldRunoff.

25. An indexing bug that caused Hot Start files with snowmelt
    parameters to be read incorrectly was fixed.

26. The setting for a non-conduit link read from a Hot Start file
    was not being used to initialize the link.

27. A bug in adjusting snowmelt for snow covered area derived from
    an areal depletion curve was fixed.

28. Snowmelt should not have been included in the total
    precipitation reported for a subcatchment since the snowfall
    which produced it was already accounted for.

29. When computing a flow rate through the Drainage Mat of a Green
    Roof LID unit, the mat's void ratio was being applied to the
    water depth instead of to the mat's area.

30. The state of LID controls was not being considered when
    choosing to use the wet or dry runoff time step which sometimes
    lead to excessive LID continuity errors.

31. A re-factoring bug that left reporting time in minutes instead
    of hours in the detailed LID results file was fixed and results
    are now written to the file at each runoff time step where the
    state of the LID unit changes.

32. Failure to initialize groundwater evaporation loss to 0 was
    causing problems with the reported groundwater mass balance
    for subcatchments that had no pervious area.

33. Excessive continuity errors for systems having conduits with
    large seepage rates was fixed.

34. Pollutant loss through seepage in conduits and storage nodes was
    not being included in the mass balance calculations.

35. Concentrations in conduits and storage nodes were not being
    increased to account for loss of water volume when evaporation
    was occurring.

36. Premature exiting of the routine that checks for capacity limited
    links whenever a non-conduit link was encountered was fixed.

37. A bug in identifying the percent of time that a conduit has either
    end full was fixed.

38. A re-factoring bug that prevented surcharged weirs (see Update 5
    for 5.1.007) from passing any flow was fixed.

39. A bug in evaluating recursive calls to nodal water quality treatment
    functions was fixed.


GUI Updates:

1.  The missing July - December column labels were restored on both
    the evaporation and wind speed tables in the Climatology Editor.

2.  The label "Surface Water Height (Hsw)" in the Groundwater Flow
    Editor was changed to "Surface Water Depth" to make clear that
    it is the depth of water at the receiving node and not the height
    of water above the aquifer bottom (or Hsw as shown in the dialog's
    diagram).

3.  The label "Channel Bottom Height (Hcb)" also in the Groundwater
    Flow Editor was changed to "Threshold Water Table Elev." to make
    clear that it is an elevation and not a height above the aquifer
    bottom (as Hcb is in the dialog's diagram).

4.  A Groundwater Summary table was added to the form that displays
    summary results tables.

5.  Groundwater upper zone soil moisture and node lateral inflow are
    now included in the abridged Hot Start file that the GUI can
    produce (using the File | Export | Hot Start File command).

6.  The column labels in the various sections of the SWMM input file
    generated by the GUI were modified to better match the labels used
    to describe the input file format in Appendix D of the Users Manual.

7.  A "Route To" field was added to the Outfall Node property editor to
    accommodate the new option of allowing outfall nodes to discharge
    onto a subcatchment.

8.  The Dynamic Wave page of the Simulation Options dialog was modified
    to include the new Minimum Routing Time Step option and the new
    Number of Threads option.

9.  The LID Control Editor was updated to include the new Rooftop
    Disconnection LID practice and the option to add a soil layer
    to the Permeable Pavement practice.

10. A Drain Outlet field was added to the LID Usage Editor.

11. The conduit Cross Section Editor dialog was enhanced to display
    a selectable list of standard size codes and their dimensions for
    elliptical and arch pipes.

12. Custom changes made to the Map's Legends are now saved with the
    rest of a  project's settings in its .ini file.

13. Word wrapping was added to the Title/Notes display in the
    Project Browser to make the contents easier to read.

14. Modal dialog message windows now appear centered over the form that
    generates them instead of in the middle of the full display screen.

15. The style of all dropdown list boxes was changed to make them more
    visually appealing.


-------------------------
Build 5.1.007 (9/15/2014)
-------------------------

Engine Updates:

1.   A new feature that provides monthly adjustments for
     temperature, evaporation rate, and rainfall was added.

2.   Support for reading the new GHCN-Daily climate data
     files available from NCDC's Climate Data Online service
     was added.

3.   In addition to lateral groundwater flow, a custom
     equation can now also be used for seepage flow to
     a deeper groundwater aquifer.

4.   The [GW_FLOW] section of the project file was renamed
     to [GWF] and its format was changed to accommodate
     both lateral and deep groundwater flow equations.

5.   A new Weir parameter was added that specifies if the
     weir can surcharge using an orifice equation or not.
     Surcharging was the only option in SWMM 5.0 but was
     switched to no surcharing in earlier 5.1 releases.
     This new parameter accommodates both closed top weirs
     that can surcharge and open channel weirs that cannot.

6.   The formula used to recover infiltration capacity during
     dry periods for the Modified Horton method was revised.

7.   The initial cumulative infiltration into the upper soil
     zone for Green-Ampt infiltration had been incorrectly
     set to the maximum value instead of zero.

8.   All of the Green-Ampt infiltration functions were
     re-factored to make the code easier to follow.

9.   The calculation of infiltration out of the bottom of a
     Bio-Retention Cell or Permeable Pavement LID unit with a
     zero-depth storage layer was corrected.

10.  Most of the LID simulation routines were modified to
     provide more accurate results under flooded conditions.

11.  Results written to the detailed LID results report now
     always correspond to a full reporting time step.

12.  The name of the variable used to represent the height of
     the receiving channel bottom in a user-defined groundwater
     flow equation was corrected to match the name displayed
     in the GUI's Groundwater Editor dialog (Hcb).

13.  A problem with the program crashing when a climate file
     was used to provide evaporation rates for open channels
     and storage nodes when runoff was not computed (as when
     there were no subcatchments in the project) was fixed.

14.  Flow and pollutant routing mass balance accounting was
     modified to correctly handle negative external inflows.

15.  The procedure for computing the area available for seepage
     out of a storage node that has a tabular storage curve was
     corrected.

16.  Seepage from storage units can now be modeled using Green-
     Ampt infiltration, which makes the seepage rate a function
     of storage level. The constant seepage rate option can
     still be used by setting the G-A initial moisture deficit
     to 0.

17.  The function that finds depth as a function of volume from
     a storage curve was corrected for the case where the depth
     falls within a portion of the curve where area is constant
     with depth (i.e., vertical side walls).

GUI Updates:

1.   The Object Toolbar was restored.

2.   A new page was added to the Climatology Editor to edit
     values for monthly adjustments for temperature, evaporation,
     and rainfall.

3.   A field for the new weir surcharge option was added to the
     Weir Property editor.

4.   A problem with the current project being closed without
     asking if it should be saved first whenever a new style
     theme was selected from the Program Preferences dialog
     has been fixed.

5.   The default seepage rate from an LID storage layer was changed.

6.   The Infiltration Editor was restored for editing Green-Ampt
     parameters for storage unit seepage loss.

7.   The Groundwater Flow Equation Editor was extended to accept
     equations for deep groundwater flow.


-------------------------
Build 5.1.006 (5/19/2014)
-------------------------

Engine Updates:

1.   The updating of the next time that detailed LID results
     should be written to file during a simulation was modified
     to avoid an off-by-one error.

2.   The number of decimal places for hourly evaporation written
     to a detailed LID report was increased.

3.   The amount of soil water available for evaporation in
     LID units with soil layers wasn't being limited by the
     water remaining below the wilting point.

4.   The equation that computes the rate of water infiltrating
     into permeable pavement LIDs had a misplaced parenthesis.

5.   There was a units conversion error in computing the
     contribution of a pollutant in direct precipitation
     to the water quality on a subcatchment.

GUI Updates:

1.   As a result of the switch to Delphi XE2 some components on
     the Options and Climatology dialogs were not recording that
     project data had changed after edits were made.


-------------------------
Build 5.1.005 (4/23/2014)
-------------------------

Engine Updates:

1.  A problem with reading hydraulic results from a hot start
    file was fixed.

GUI Updates:

1.  The appearance of the Open File Dialog with preview panel
    was improved.

2.  In the property Editor for storage nodes, the Ponded Area
    property was made read-only since storage nodes are not
    allowed to pond water.

3.  Some issues with pop-up topic windows in the Help file
    being obscured by the main Help window were fixed.


-------------------------
Build 5.1.004 (4/14/2014)
-------------------------

Engine Updates:

1.  Support for the Ignore RDII analysis option was added to
    the engine.

GUI Updates:

1.  A refactoring bug that ignored any changes to numerical
    precision made in the Program Preferences dialog was fixed.

2.  Another refactoring bug from 5.1.003 that caused projects
    with groundwater aquifers not to run was fixed.


------------------------
Build 5.1.003 (4/8/2014)
------------------------
Engine Updates:

1.  A new property, the Upper Zone Evap. Pattern, was added to
    the Aquifer object. It allows one to adjust the aquifer's
    upper zone evaporation fraction by month of the year.

2.  A bug in writing/reading RDII flows to the new binary RDII
    file was fixed.

GUI Updates:

1.  A refactoring bug that prevented SWMM from working
    correctly for users with non-US Windows regional settings
    was fixed.

2.  A refactoring bug the prevented the Group Delete feature from
    working was fixed.

4.  Issues with stay-on-top forms obscuring modal dialog forms,
    with the Browser panel disappearing if its width was made too
    small and with not being able to browse the Help system when a
    modal form had focus were fixed (these unforseen issues were
    caused by the switch to Delphi XE2 from Delphi 7).

5.  The Aquifer Editor form was updated to accept the new upper
    evaporation pattern property.


-------------------------
Build 5.1.002 (3/31/2014)
-------------------------
Engine Updates:

1.  A bug that prevented hotstart files with the latest format
    from being read was fixed.

2.  Only non-ponded surface area is saved for use in the dynamic
    wave surcharge algorithm (when water depth is close to the
    node's crown elevation).

GUI Updates:

1.  Creation of auxilary forms on startup was moved from the
    main form's OnActivate event to its OnCreate event, while
    creation of the map form was moved tothe OnShow event.

2.  The routines for saving and reading the main form's position
    and size in the swmm5 .ini file were modified.

3.  A memory leak related to copying cells from the grid editor
    used in various dialogs was fixed.


-------------------------
Build 5.1.001 (3/24/2014)
-------------------------
Engine Updates

New Features:
=============
1.  SWMM can now read the new file format for precipitation
    data retrieved online from NOAA-NCDC.

2.  A new choice of infiltration method, the Modified Horton
    method, has been added. This method uses the cumulative
    infiltration in excess of the minimum rate as its state
    variable (instead of time along the Horton curve),
    providing a more accurate infiltration estimate when
    low rainfall intensities occur.

3.  RDII interface files created internally by SWMM are now
    saved in a binary format to reduce storage space. The ASCII
    text format for these files is still supported for users
    that find it desireable to create the files outside of SWMM.

4.  Two new categories of LID controls, one for Green Roofs and
    another for Rain Gardens, have been added so they no longer
    have to be configured from the Bio-Retention Cell control
    (although that option still remains). The Green Roof uses
    a new Drainage Mat layer to store and convey the water that
    percolates through the soil layer.

5.  Users can now add their own groundwater outflow equation to
    a subcatchment, to be used in place of or in addition to the
    standard equation. Similar to treatment functions, the equation
    can be any mathematical expression that uses the same ground-
    water variables that appear in the standard equation.

6.  Evaporation of water from open channels has been added.

7.  A new conduit property named Seepage Rate (in/hr or mm/hr)
    has been added to model uniform seepage along the bottom
    and sloped sides of a conduit.

8.  Infiltration from storage units is now referred to as
    seepage, to be consistent with seepage from conduits. The
    only required parameter is a seepage rate (in/hr or mm/hr).
    Previous data files that supply a set of Green-Ampt
    infiltration parameters will still be recognized.

9.  Separate accounting and reporting of evaporation and
    seepage losses in storage units is now made.

10. Open rectangular channels now have a new parameter that
    specifies if one or both side wall surfaces should be
    ignored when computing a hydraulic radius (to provide
    improved support for quasi-2D modeling of wide channels
    and overland flooding).

11. New Dynamic Wave Analysis options have been added for
    the maximum number of iterations and head tolerance used
    at each time step. The percentage of time steps where
    convergence is not achieved is also now reported.

12. Users can now set the flow tolerances that determine if
    flow routing calculations can be skipped because steady
    state conditions hold.

13. Control rules can now use a conduit's OPEN/CLOSED status
    in both premise conditions and action clauses.

14. The meaning of the link view variable "Capacity" has been
    changed. For conduits it is now the fraction of the full
    cross section area filled by the flow, while it is the
    control setting for all other types of links (the meaning
    of the control setting varies by link type -- see the Help
    file or the Users Manual).

15. The link Froude number view variable has been replaced with
    the link's flow volume, the subcatchment Losses variable has
    been replaced by two new variables - Evaporation and
    Infiltration, and upper groundwater zone Soil Moisture has
    been added as a new view variable.

16. The Node Inflows Summary table of the Status Report now
    includes a new column that lists the mass balance error
    in volume units for each node.

17. A new summary table, Link Pollutant Load, has been added
    that displays the total mass load of each pollutant that
    flows through each link.

Improvements:
=============
18. Using a Drain Delay time of 0 for Rain Barrel LIDs now means
    that the barrel is allowed to drain continuously, even as it
    is filling during wet weather periods.

19. The requirement that an impervious surface must be dry
    (have no more than 0.05 inches of standing water) before
    it could be subjected to street sweeping has been dropped.

20. After runoff ceases and a land surface goes dry due to
    evaporation, any remaining mass of pollutant originating
    from direct deposition or upstream runon is assumed to be
    unavailabe for future washoff (it shows up as Remaining
    Buildup in the mass balance report).

21. The way that wet weather washoff inflow loads are
    interpolated across a flow routing time step was modified
    to produce a better match between the reported total runoff
    load and total quality routing inflow load.

22. The method used to select a time step for processing RDII
    unit hydrographs was modified to consider the case where
    K (the ratio of rising limb to falling limb duration) is
    below 1.0.

23. When the moisture content of the upper groundwater zone
    reaches saturation, the depth of the lower saturated zone
    is now set equal to the full aquifer depth (minus a small
    tolerance).

24. Conduits with negative slopes whose absolute value is
    below the Minimum Slope option will have their slope
    changed to the positive minimum value, thus allowing
    them to be analyzed using the Steady Flow and Kinematic
    Wave routing options.

25. The Avg. Froude Number and Avg. Flow Change columns in the
    Flow Classification Summary table have been replaced with the
    fraction of time steps that flow is limited to normal flow
    and the fraction of time steps that flow is inlet controlled
    (for culverts).

26. An error condition now occurs if a pump's startup depth
    is less than its shutoff depth.

27. Only the upstream node for orifice and weir links is now
    checked to see if its maximum depth needs to be increased
    to meet the top elevation of the orifice or weir opening.

28. Weirs are no longer allowed to operate as an orifice when
    they surcharge. Instead any excess flow will flood the
    upstream node.

29. A warning message is now written to the Status Report if
    the crest elevation of a regulator link is below its
    downstream node's invert.

30. When a reporting time falls in between a computational time
    step during which a pump's on/off status changes, the reported
    pump flow is the value at either the start or end of the time
    step depending on which is closer to the reporting time (i.e.,
    no interpolation is used).

31. Control rule conditions can now accept elapsed time or
    time of day values as decimal hours in addition to hours:
    minutes:seconds.

32. The test for a control rule condition equaling a specified
    elapsed time or time of day was modified to more accurately
    capture its occurrence.

33. If the Water Quality analysis option is disabled then the
    binary results file no longer contains any pollutant values
    (of 0) for all time periods.

34. Hot Start files now contain the complete state of the watershed
    and conveyance system, so that future simulations can start up
    correctly where they left off.

35. The following changes to error reporting were made:
    - Error 319 was re-numbered to 320 and a new Error 319
      was added for a rainfall data file with unknown format.
    - Format errors in external time series files are now
      listed as Error 363 (invalid data) instead of Error
      173 (time series out of sequence).

36. Warning messages written to the Status Report are now
    single spaced instead of double spaced. See report.c.

37. The Link Summary table in the Status Report now lists conduits
    with negative slopes in their original orientation instead of
    in their reversed state.

Bug Fixes:
==========
38. A refactoring bug from 5.0.022 that prevented snowmelt
    from infiltrating has been fixed.

39. Snowmelt rate during rainfall conditions and the updating
    of the antecedent temperature index were were not being
    converted from the six hour time interval used in Anderson's
    original NWS snowmelt model to the hourly basis used in SWMM.

40. A refactoring bug that failed to set the maximum number of
    characters high enough for a line read from a user-prepared
    rainfall data file has been fixed.

41. The optional Maximum Volume parameter for Horton
    infiltration was not allowing any recovery of infiltration
    capacity between storm events.

42. Evaporation from the lower groundwater zone was being
    computed from the rate remaining after surface and upper
    zone evaporation was considered instead of from the
    unadjusted rate (with a reduction afterwards if it exceeds
    the remaining available rate).

43. An error in applying the Vegetation Volume Fraction parameter
    to swales was corrected.

44. The time from the last rainfall used to determine when a
    Rain Barrel should begin to empty wasn't being computed
    correctly.

45. An erroneous error message for Rain Barrel LIDs with a
    zero Void Ratio has been fixed (the Void Ratio parameter
    should be ignored for Rain Barrels).

46. The display of extraneous infiltration results in detailed
    reports for Rain Barrel LIDs has been eliminated.

47. The check on no street sweeping for a subcatchment during
    wet periods was checking rainfall over the entire study
    area instead of just the subcatchment.

48. An erroneous warning message regarding negative offsets for
    pumps when elevation offsets are used has been eliminated.

49. A possible divide by zero error for trapezoidal channels
    with zero bottom width has been eliminated.

50. A program crash that occurred when the Ignore Routing
    option was selected and results were to be saved to a
    Routing Interface file has been fixed.

51. Projects that had no subcatchments or had the Ignore
    Runoff switch selected were not able to evaporate water
    from storage units.

52. Weekday and weekend hourly time patterns for Dry Weather
    inflows are now correctly applied in a mutually exclusive
    manner.

53. The Node Flooding Summary table in the Status Report now
    correctly lists the peak depth of ponded water above the
    node's maximum depth (i.e., its rim or ground elevation)
    instead of above its invert elevation.

54. Occasional problems caused by the date/time functions not
    returning an hour between 0 and 23 (for hourly time patterns)
    and being off by 1 second (when writing results to outflow
    interface files) have been fixed.

55. A bug introduced in release 5.0.017 that caused the
    concentration after first-order decay in a storage node to
    be ignored has been fixed.

56. A bug in the Total Elapsed Time listed at the end of the
    Status Report for runs taking longer than 24 hours of
    computer time was fixed.

57. A correction was made for the slope correction factor used
    for mitered culvert inlets.

58. The procedure for finding the surface area of a storage unit
    given its volume was corrected for the case where the
    storage curve has a section of decreasing area with depth.

59. The procedure for finding a cross-section area given a
    section factor value was corrected for the case where the
    section factor table does not have its highest value as
    the last entry in the table.

60. An error in computing the hydraulic radius of the Rectangular-
    Triangular conduit shape as a function of flow depth was
    corrected.

GUI Updates

1.  The entire GUI code was ported from Delphi 7 into Delphi XE2.

2.  Different color themes for the user interface can be
    selected from the Program Preferences dialog.

3.  The "Data" Browser panel is now named as the "Project"
    Browser.

4.  The Object Toolbar has been eliminated. Visual objects
    are now added to the map in the same manner as non-visual
    objects -- by selecting their category from the Project
    Browser and then clicking the Browser's "+" button (or
    by selecting Project | Add... on the main menu).

5.  The LID Control and LID Usage editors were re-designed to
    accomodate the new LID control options.

6.  Modifications were made to accept the new engine features
    mentioned above (modified Horton infiltration, seepage rate
    parameter for conduits, side wall option for rectangular
    channels, and the additional Dynamic Wave routing options).

7.  Modifications were made to accept the updated set of output
    view variables.

8.  The summary results tables that used to appear as part of the
    Status Report have been moved into a separate Summary Report
    that makes it easier to view and sort them.

9.  The Time Series Plot selection dialog was modified to allow
    more than one kind of object/variable pair to be plotted.

10. The Graph Options dialog was modified to allow a vertical
    axis to be inverted (as when plotting an inverted rainfall
    hyetograph on the same graph as a runoff hydrograph).

11. The option to compute evaporation using the Hargreaves
    equation wasn't being saved along with the rest of a project.

12. If pollutants are defined for a project but the Water Quality
    analysis option is not selected, then after a new analysis is
    made pollutants will no longer be listed as theme variables in
    the Map Browser nor will they be available for graphs, tables
    or statistical reports.

13. The columns for the [XSECTIONS] section of a saved project
    file now includes a heading label for "Culvert Code".
